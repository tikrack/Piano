<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>
</head>
<body>
<button id="start">Start 101 Hz</button>
<button id="stop">Stop</button>
<script>
    let ctx;
    const oscillators = {};

    const play = (freq) => {
        if (!ctx || ctx.state === "closed") {
            ctx = new (window.AudioContext || window.webkitAudioContext)();
        }

        const osc = ctx.createOscillator();
        const gain = ctx.createGain();

        osc.type = "sine"; // ["sawtooth", "triangle"]

        osc.frequency.setValueAtTime(freq, ctx.currentTime);

        const now = ctx.currentTime;

        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(0.4, now + 0.01);

        osc.connect(gain).connect(ctx.destination);
        osc.start(now);

        oscillators[freq] = {osc, gain};
    };

    const stop = (freq) => {
        const node = oscillators[freq];
        if (!node) return;

        const {osc, gain} = node;
        const t = ctx.currentTime;

        gain.gain.cancelScheduledValues(t);
        gain.gain.setValueAtTime(gain.gain.value, t);
        gain.gain.linearRampToValueAtTime(0, t + 0.1);

        osc.stop(t + 0.15);

        delete oscillators[freq];

        if (Object.keys(oscillators).length === 0) {
            setTimeout(() => ctx.close(), 200);
        }
    };


    document.getElementById('start').onclick = () => {
        play(440.000)
        setTimeout(() => stop(440.000), 200)
    };
</script>
</body>
</html>